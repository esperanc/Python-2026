<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SlideDown</title>

    <link id="theme-style" rel="stylesheet" href="lib/themes/default.css" />
    <!-- Highlight.js CSS (Atom One Dark) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="lib/style.css" />

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script src="lib/parser.js"></script>
    <script src="lib/renderer.js"></script>
    <script src="lib/navigation.js"></script>
    <script src="lib/themes.js"></script>
  </head>
  <body>
    <div id="loading">Loading...</div>
    
    

    <div id="scrolly-container"></div>

    <div id="menu-container" style="display:none; padding: 40px;">
    <h1>SlideDown<a href="https://github.com/esperanc/SlideDown" target="_blank" class="github-link" aria-label="View on GitHub">
        <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
    </a></h1>
    
    <h2 style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 20px;">Available Presentations</h2>
    <div id="list-wrapper">
        <ul id="presentation-list"></ul>
    </div>
</div>

    <script>

      async function init() {
        // Inicializa gerenciador de temas
        if (window.themeManager) window.themeManager.init();

        const loadingEl = document.getElementById("loading");
        const menuEl = document.getElementById("menu-container");
        const containerEl = document.getElementById("scrolly-container"); // Referência ao container

        // 1. Ler parâmetros da URL
        const params = new URLSearchParams(window.location.search);
        const folderName = params.get("p");
        // Remove trailing slash if present
        const fParam = params.get("f") ? params.get("f").replace(/\/$/, "") : null;
        const baseContentPath = fParam || "content";

        // --- MODO MENU (Se não tem 'p' na URL) ---
        if (!folderName) {
          loadingEl.style.display = "none";

          // CORREÇÃO: Esconde o container de slides para não ocupar espaço
          containerEl.style.display = "none";

          // Mostra o menu
          menuEl.style.display = "block";

          loadMenu(baseContentPath, fParam);
          return;
        }

        // --- MODO APRESENTAÇÃO ---
        try {
          // Garante que o menu está escondido e o container visível
          menuEl.style.display = "none";
          containerEl.style.display = "block";

          // ... (resto do código de carregamento: fetch, parser, renderer) ...
          const basePath = `${baseContentPath}/${folderName}/`;
          const mdUrl = `${basePath}slides.md`;

          const response = await fetch(mdUrl);
          if (!response.ok)
            throw new Error(`Apresentação não encontrada: ${folderName}`);
          const markdownText = await response.text();

          const parser = new ScrollyParser();
          const renderer = new ScrollyRenderer("scrolly-container", {
            basePath: basePath,
          });

          renderer.render(parser.parse(markdownText));

          const nav = new ScrollyNavigation('scrolly-container', folderName);
          nav.init();

          loadingEl.style.display = "none";
        } catch (error) {
          // Em caso de erro, esconde container e mostra mensagem
          loadingEl.style.display = "none";
          containerEl.style.display = "none";
          menuEl.style.display = "block";
          menuEl.innerHTML = `<h1>Erro</h1><p>${error.message}</p><a href="index.html">Voltar ao Início</a>`;
        }
      }
      // Função extra para listar aulas (lendo de um arquivo json estático)
      async function loadMenu(basePath, fParam) {
        try {
          // Você precisa criar um arquivo index.json na raiz listando suas pastas
          const response = await fetch(`${basePath}/index.json`);
          const presentations = await response.json();
          const list = document.getElementById("presentation-list");
          presentations.forEach((item) => {
            const li = document.createElement("li");
            const fQuery = fParam ? `&f=${encodeURIComponent(fParam)}` : "";
            li.innerHTML = `<a href="?p=${item.folder}${fQuery}" style="color:var(--accent-color); font-size:1.5rem;">${item.title}</a>`;
            list.appendChild(li);
          });
        } catch (e) {
          document.getElementById("presentation-list").innerHTML =
            "<li>Crie um arquivo 'index.json' para listar suas aulas aqui.</li>";
        }
      }

      window.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
